.\"Generated by db2man.xsl. Don't modify this, modify the source.
.de Sh \" Subsection
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Ip \" List item
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.TH "IPSEC_SHOWHOSTKEY" 8 "" "" ""
.SH NAME
ipsec showhostkey \- show host's authentication key
.SH "SYNOPSIS"
.ad l
.hy 0
.HP 6
\fBipsec\fR \fIshowhostkey\fR [\-\-file\ \fIsecretfile\fR] [\-\-id\ \fIidentity\fR]
.br
 \fB\-\-dhclient\fR | \fB\-\-left\fR | \fB\-\-right\fR | \fB\-\-txt\ \fIgateway\fR\fR | \fB\-\-ipseckey\ \fI<@fqdn|ip\-addr>\fR\fR | \fB\-\-key\fR | \fB\-\-help\fR 
.ad
.hy

.SH "DESCRIPTION"

.PP
\fIShowhostkey\fR outputs (on standard output) a public key suitable for this host, in the format specified, using the host key information stored in \fI/etc/ipsec\&.secrets\fR\&. It generates records for Opportunistic Encryption \- various formats are supported\&.

.PP
In general only the super\-user can run this command, since only he can read \fIipsec\&.secrets\fR\&.

.PP
The \fB\-\-txt\fR option causes the output to be in opportunistic\-encryption DNS TXT record format, with the specified \fIgateway\fR value\&. If information about how the key was generated is available, that is provided as a DNS\-file comment\&. For example, \fB\-\-txt 10\&.11\&.12\&.13\fR might give (with the key data trimmed for clarity):

.nf

  ; RSA 2048 bits   xy\&.example\&.com   Sat Apr 15 13:53:22 2000
      IN TXT  "X\-IPsec\-Server(10)=10\&.11\&.12\&.13 AQOF8tZ2\&.\&.\&.+buFuFn/"

.fi

.PP
No name is supplied in the TXT record because there are too many possibilities, depending on how it will be used\&. If the text string is longer than 255 bytes, it is split up into multiple strings (matching the restrictions of the DNS TXT binary format)\&. If any split is needed, the first split will be at the start of the key: this increases the chances that later hand editing will work\&.

.PP
The \fB\-\-left\fR and \fB\-\-right\fR options cause the output to be in \fBipsec\&.conf\fR(5) format, as a \fIleftrsasigkey\fR or \fIrightrsasigkey\fR parameter respectively\&. Again, generation information is included if available\&. For example, \fB\-\-left\fR might give (with the key data trimmed down for clarity):

.nf

  # RSA 2048 bits   xy\&.example\&.com   Sat Apr 15 13:53:22 2000
  leftrsasigkey=0sAQOF8tZ2\&.\&.\&.+buFuFn/

.fi

.PP
The \fB\-\-dhclient\fR option cause the output to be suitable for inclusion in \fBdhclient\&.conf\fR(5) as part of configuring WAVEsec\&. See <http://www\&.wavesec\&.org: \fIhttp://www.wavesec.org\fR>\&.

.PP
If \fB\-\-ipseckey\fR is specified, the output format is the text form of a DNS IPSECKEY record as per RFC\-4025\&. The host name is the one included in the key information (or, if that is not available, the output of \fBhostname\~\-\-fqdn\fR), with a \fI\&.\fR appended\&.

.PP
If \fB\-\-key\fR is specified, the output format is the text form of a DNS KEY record; the host name is the one included in the key information (or, if that is not available, the output of \fBhostname\~\-\-fqdn\fR), with a \fI\&.\fR appended\&. Again, generation information is included if available\&. For example (with the key data trimmed down for clarity):

.nf

  ; RSA 2048 bits   xy\&.example\&.com   Sat Apr 15 13:53:22 2000
  xy\&.example\&.com\&.   IN   KEY   0x4200 4 1 AQOF8tZ2\&.\&.\&.+buFuFn/

.fi

.PP
Note that the KEY record has been restricted by RFC 3445 for DNS use only\&. Instead, the IPSECKEY record should be used using the \fB\-\-ipseckey\fR option\&.

.PP
Normally, the default key for this host (the one with no host identities specified for it) is the one extracted\&. The \fB\-\-id\fR option overrides this, causing extraction of the key labeled with the specified \fIidentity\fR, if any\&. The specified \fIidentity\fR must \fIexactly\fR match the identity in the file; in particular, the comparison is case\-sensitive\&.

.PP
The \fB\-\-file\fR option overrides the default for where the key information should be found, and takes it from the specified \fIsecretfile\fR\&.

.SH "DIAGNOSTICS"

.PP
A complaint about “no pubkey line found” indicates that the host has a key but it was generated with an old version of FreeS/WAN and does not contain the information that \fIshowhostkey\fR needs\&.

.SH "FILES"

.PP
/etc/ipsec\&.secrets

.SH "SEE ALSO"

.PP
ipsec\&.\fBsecrets\fR(5), ipsec\&.\fBconf\fR(5), \fBipsec_rsasigkey\fR(8)

.SH "HISTORY"

.PP
Written for the Linux FreeS/WAN project <http://www\&.freeswan\&.org: \fIhttp://www.freeswan.org\fR> by Henry Spencer\&.

.SH "BUGS"

.PP
Arguably, rather than just reporting the no\-IN\-KEY\-line\-found problem, \fIshowhostkey\fR should be smart enough to run the existing key through \fIrsasigkey\fR with the \fB\-\-oldkey\fR option, to generate a suitable output line\&.

.PP
The need to specify the gateway address (etc\&.) for \fB\-\-txt\fR is annoying, but there is no good way to determine it automatically\&.

.PP
There should be a way to specify the priority value for TXT records; currently it is hardwired to 10\&.

.PP
The \fB\-\-id\fR option assumes that the \fIidentity\fR appears on the same line as the \fI:\~RSA\~{\fR that begins the key proper\&.

